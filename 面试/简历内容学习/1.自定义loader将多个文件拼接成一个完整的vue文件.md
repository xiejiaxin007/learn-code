# 自定义webpack loader进行文件拼接

## 实际场景
### 在大型项目中，如果一个vue文件太大，我们会采取拆分组件的方式
将项目中可以抽离的内容都进行抽离（不一定是公共组件），因为我们主要是想减少一个vue文件的代码量

### 在大型项目中，如果一个vue文件太大，我们也可以对文件进行拆分
如果提取了代码之后，文件仍然很大，或者是如果提取出来之后，代码的可读性很差，我们可以采取文件拆分的方式：
将一个vue文件，差分成html（template.vue）、js、css三个部分，也就是三个文件
然后我们通过一个自定义loader来进行自动拼接即可

### 优点
1. 整个项目结构很清晰且统一
2. 减少一个打包后一个模块的代码量（大型项目，而且vue文件的业务代码特别庞大）

### 缺点
1. 项目编译时间增长，因为vue文件需要单独的loader进行代码拼接
2. 有一定的培训成本，对于新人，需要单独进行开发注意事项通知

*** 

## 自定义loader的编写
> webpack自定义loader实际就是一个js函数，将文件内容作为参数进行输入，然后经过这个函数的操作又将内容给返回出去，也就完成了loader的任务了

#### 创建
首先，我们这个自定义loader由于是本项目单独使用的，所以没有进行发布，而是直接在项目中创建就了一个js
``` javascript
module.exports = function(content) {
    console.log('执行loader咯')
    return content
}
```
#### 配置
项目中需要对loader进行配置，告诉打包器，这个loader作用于什么路径、作用于什么文件等等
``` javascript
// vue.config.js OR webpack.config.js
const { defineConfig } = require("@vue/cli-service");
const {resolve}  = require('path');
module.exports = defineConfig({
  transpileDependencies: true,
  chainWebpack: config => {
    config.module
      .rule('custom-js')
        .test(/\.js$/)
        .pre()
        .include
        .add(resolve(__dirname,'./src/views/product'))
        .end()
          .use('handFileLoader')
          .loader(require.resolve('./src/utils/handFileLoader.js'))
          .end()
        .end()
  }
});
```

#### 使用
注意，拼接文件的时候需要告诉loader，所以在项目中，我采用的是```{{{set:}}}```关键字
```vue
<!-- vue 文件 -->
<template>
<h1 class="test-class">这个是html部分</h1>
</template>
{{{set:xxx/xxx/index.vue}}}
```

```JavaScript
// mixin.js
export default {
    name: 'test'
}
```

```scss
// index.css
.test-class{}
```
##### 代码拼接部分
```javascript
const directory = directoryArr.join('/')
let importJsStr = `import mixin from '@/${type}/${directory}/mixin.js'`
let importStyleStr = `@import '@/${type}/${directory}/index.scss'`
let res = `
    <script>
        ${importJsStr}
        export default {
            mixins: [mixin]
        }
    </script> 
    <style lang="scss" scoped>
        ${importStyleStr}
    </style>
`
```

